FROM centos:7 as build

ENV CGO_ENABLED=0 
ENV GOOS=linux
RUN rpm --rebuilddb && yum -y install \
    wget \
    make \
    gcc \
    git
RUN wget -q https://dl.google.com/go/go1.14.2.linux-amd64.tar.gz
RUN mkdir -p /usr/local/bin
RUN tar xf go1.14.2.linux-amd64.tar.gz -C /usr/local
RUN ln -s /usr/local/go/bin/* /usr/local/bin

RUN mkdir -p /build
ADD . /build/
ENV CGO_ENABLED=0 
ENV GOOS=linux
RUN go build -o user-linux-amd64 user.go


FROM eos/base
RUN mkdir -p /usr/local/bin
COPY --from=build /build/user-linux-amd64 /usr/local/bin/user
RUN chmod +x /usr/local/bin/user

ENTRYPOINT ["/usr/local/bin/user"]
